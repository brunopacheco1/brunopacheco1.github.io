<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Bruno Pacheco">
    <meta name="description" content="https://brunopacheco1.github.io">
    <meta name="keywords" content="blog,developer,personal">

    <meta property="og:site_name" content="Bruno Pacheco">
    <meta property="og:title" content="
  Optimizing Decision Making with a Trie Tree-Based Rules Engine: An Experience Report - Bruno Pacheco
">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://brunopacheco1.github.io/posts/optimizing-decision-making-with-trie-tree/">
    <meta property="og:image" content="https://brunopacheco1.github.ioimages/tn.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="https://brunopacheco1.github.io/posts/optimizing-decision-making-with-trie-tree/">
    <meta name="twitter:image" content="https://brunopacheco1.github.ioimages/tn.png">

    <base href="https://brunopacheco1.github.io/posts/optimizing-decision-making-with-trie-tree/">
    <title>
  Optimizing Decision Making with a Trie Tree-Based Rules Engine: An Experience Report - Bruno Pacheco
</title>

    <link rel="canonical" href="https://brunopacheco1.github.io/posts/optimizing-decision-making-with-trie-tree/">
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    
    <link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
    <link rel="stylesheet" href="/css/normalize.min.css">
    <link rel="stylesheet" href="/css/style.min.css">

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    
      <link rel="alternate" href="https://brunopacheco1.github.io/index.xml" type="application/rss+xml" title="Bruno Pacheco">
      <link href="https://brunopacheco1.github.io/index.xml" rel="feed" type="application/rss+xml" title="Bruno Pacheco" />
    

    <meta name="generator" content="Hugo 0.109.0">
  </head>

  <body class="">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">Bruno Pacheco</a>
    <input type="checkbox" id="menu-control"/>
    <label class="menu-mobile  float-right " for="menu-control">
      <span class="btn-mobile  float-right ">&#9776;</span>
      <ul class="navigation-list">
        
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="https://brunopacheco1.github.io/posts">Blog</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="https://brunopacheco1.github.io/about">About</a>
            </li>
          
        
        
      </ul>
    </label>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
  <article>
    <header>
      <h1 class="title">Optimizing Decision Making with a Trie Tree-Based Rules Engine: An Experience Report</h1>
      <h2 class="date">January 24, 2023</h2>

      
    </header>

    <p>In Pictet Technologies, my team relies a lot on decision models. These models allow our business analysts to input Compliance business rules directly into the systems with minimal developer intervention. When I joined the company, we used to use both <a href="https://www.kie.org/">Drools</a> and <a href="https://camunda.com/">Camunda</a>. However, we faced severe memory and performance issues, specifically with Camunda, prompting me to explore alternatives.</p>
<p>For those not familiar with these solutions, both are rules engine providers. And a rules engine is a software system designed to process and execute sets of business rules. These rules provide automated decisions based on a set of inputs. In a nutshell, a rules engine is a very sophisticated if/else interpreter. For more details, I suggest you follow this <a href="http://www.mastertheboss.com/bpm/drools/what-is-a-rule-engine/">link</a>.</p>
<p>The first challenge I encountered was with the decision model and notation file (or DMN). By the way, DMN is the “standard” format that both Drools and Camunda implement. While it is relatively easy to understand, it is impossible to load the same file on both vendors. Another point is that most of our cases are simple decision tables. If it were not for the number of rules, it would be simpler to code the business rules in Java directly.</p>
<p>But the most critical issue related to these engines was performance. Our DMN-based services struggled to handle concurrent usage. Even on single requests, the process took longer than our clients were expecting.</p>
<h2 id="starting-the-journey">Starting the journey</h2>
<p>Initially, I evaluated alternative solutions, but ultimately, Drools and Camunda were the dominant players in the field when I started these studies. And both were and still are easy to use and integrate with, free to use, and offer tools for maintaining the DMN files.</p>
<p>The next step was using a database, where the rules could be stored and easily accessed through queries. However, this approach quickly resulted in poor performance.</p>
<p>Eventually, I began exploring the possibility of developing my solution, which prompted me to conduct research. That was when I discovered the Trie Tree, a rather basic data structure that arranges words in shared prefixes. Please, follow this <a href="https://www.toptal.com/java/the-trie-a-neglected-data-structure">link</a> for details on how Trie Tree works. There is also this <a href="https://www.cs.usfca.edu/~galles/visualization/Trie.html">visualization tool</a> to get acquittance with this data structure.</p>
<p><img src="/images/optimizing-decision-making-with-trie-tree/triedatastructure.png" alt="Trie Tree representation"></p>
<p>Image reused from <a href="https://www.geeksforgeeks.org/trie-insert-and-search/">GeeksForGeeks</a></p>
<p>Upon closer examination, I found that treating each input of a rule as a character in a string, Trie Tree is a good solution for a rules engine. The challenge when I started developing it was the “ANY” value, which allows any input value for a given entry. To accommodate this, it was necessary to accurately propagate the children of the ANY node to all siblings, and vice versa, ensuring the correct branch may be traversed.</p>
<p>Another challenge of implementing the Trie Tree was the multiple rules triggering implemented by both vendors. To achieve it using Trie, the leaf node should contain a sorted collection of rule IDs - the sorting mechanism depends on the Hit Policy selected by the developer. In most of our cases, we use the FIRST hit policy, which retrieves the first element of the collection sorted by rule id.</p>
<h2 id="reviewing-the-solution">Reviewing the solution</h2>
<p>The overall performance was exceptional, as demonstrated later. However, memory consumption remained high. After studying other Trie Tree implementations - <a href="https://www.cs.usfca.edu/~galles/visualization/RadixTree.html">Radix Tree</a> is an example - I developed an algorithm to eliminate ANY nodes without siblings, as it is always the default branch. This approach reduced some subtrees to just one node.</p>
<p>After further testing, I realized that the number of nodes is significantly smaller if I ordered the inputs appropriately. That is a computationally complex problem, but luckily, there is a simple approach to avoid testing all possible scenarios. One should sort the input entries based on the number of ANY values they have. In one particular service, this technique allowed us to reduce the number of nodes from 30k to 1.5k.</p>
<h2 id="preparing-this-article">Preparing this article</h2>
<p>First, I transformed this Trie Tree implementation into an open-source project, which I called <a href="https://github.com/brunopacheco1/praecepta">Praecepta</a> (Rules in Latin), so anyone can try it out. Then, I added three modules to it, with a decision table based on a real scenario (blurred input/output values). Each module uses a different framework: Praecepta, Camunda 7, and <a href="https://kogito.kie.org/">Kogito</a> (the newest Kie solution for the Cloud).</p>
<p>I used SpringBoot 3.0.2, GraalVM 22 (JVM mode), a MacOS 2,6 GHz 6-Core Intel Core i7, running 1000 users for 5 minutes. The idea was to test how memory consumption and CPU usage evolve. Below, I compared the footprint of these three solutions. I collected the total count of requests, throughput, memory consumption, and CPU usage using <a href="https://visualvm.github.io/">VisualVM</a> and <a href="https://gatling.io/">Gatling</a>.</p>
<h2 id="beating-kogito-and-camunda">Beating Kogito and Camunda</h2>
<p>The numbers do not lie!</p>
<table>
<thead>
<tr>
<th>Solution</th>
<th>Requests (total count)</th>
<th>Throughput (mean count/s)</th>
<th>Memory (Peak)</th>
<th>CPU</th>
</tr>
</thead>
<tbody>
<tr>
<td>Praecepta</td>
<td>6.614.663</td>
<td>21.337</td>
<td>~100MB</td>
<td>~25%</td>
</tr>
<tr>
<td>Kogito</td>
<td>3.615.549</td>
<td>11.663</td>
<td>~225MB</td>
<td>~30%</td>
</tr>
<tr>
<td>Camunda 7</td>
<td>1.238.667</td>
<td>3.995</td>
<td>~450MB</td>
<td>~35%</td>
</tr>
</tbody>
</table>
<h2 id="conclusions">Conclusions</h2>
<p>You can see the results below.</p>
<p>Sadly Camunda 7 did not perform well. It was 3x slower and 2x bigger than Kogito. The last proved acceptable given the numbers, but still, it had twice as much memory as Praecepta. Praecepta, on the other hand, steadily kept memory below 100MB, with low CPU usage and 2x greater throughput, compared to the second place.</p>
<p>The outcome is not that Kogito nor Camunda sucks. It always depends on what we plan and want in our system. If you have a much more complex scenario, Kogito or Camunda may fit better to your needs, but first, you should evaluate other solutions before buying/using one of them.</p>
<p>For our team, a simple data structure had an immensely positive impact. We could provide microservices with a smaller footprint and much higher availability.</p>
<p>For me, It was an excellent opportunity to use my computer science background and learn new things.</p>
<h2 id="results">Results</h2>
<h3 id="praecepta---trietree">Praecepta - TrieTree</h3>
<p><img src="/images/optimizing-decision-making-with-trie-tree/gatling_praecepta-benchmark.png" alt="Trie Tree gatling"></p>
<p><img src="/images/optimizing-decision-making-with-trie-tree/jvisualvm_praecepta-benchmark.png" alt="Trie Tree jvm"></p>
<h3 id="kogito">Kogito</h3>
<p><img src="/images/optimizing-decision-making-with-trie-tree/gatling_praecepta-kogito-benchmark.png" alt="Kogito gatling"></p>
<p><img src="/images/optimizing-decision-making-with-trie-tree/jvisualvm_praecepta-kogito-benchmark.png" alt="Kogito jvm"></p>
<h3 id="camunda">Camunda</h3>
<p><img src="/images/optimizing-decision-making-with-trie-tree/gatling_praecepta-camunda-benchmark.png" alt="Camunda gatling"></p>
<p><img src="/images/optimizing-decision-making-with-trie-tree/jvisualvm_praecepta-camunda-benchmark.png" alt="Camudna jvm"></p>
<p><strong>See you | Bis geschwënn | Até mais | À bientôt</strong></p>

  </article>

  <br/>

  
  
</section>

      </div>
      
        <footer class="footer">
  <section class="container">
    
      <div class="sns-shares sp-sns-shares">
        
          <a class="sns-share twitter-share" href="https://twitter.com/intent/tweet?original_referer=https%3a%2f%2fbrunopacheco1.github.io%2fposts%2foptimizing-decision-making-with-trie-tree%2f&ref_src=twsrc%5Etfw&text=Optimizing%20Decision%20Making%20with%20a%20Trie%20Tree-Based%20Rules%20Engine%3a%20An%20Experience%20Report Bruno%20Pacheco&tw_p=tweetbutton&url=https%3a%2f%2fbrunopacheco1.github.io%2fposts%2foptimizing-decision-making-with-trie-tree%2f"><i class="fab fa-twitter"></i></a>
        
        
          <a class="fb btn sns-share fb-share" href="http://www.facebook.com/share.php?u=https%3a%2f%2fbrunopacheco1.github.io%2fposts%2foptimizing-decision-making-with-trie-tree%2f" onclick="window.open(this.href, 'FBwindow', 'width=650, height=450, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fab fa-facebook-f"></i></a>
        
        
          <a class="sns-share hatena-share" href="http://b.hatena.ne.jp/entry/https://brunopacheco1.github.io/posts/optimizing-decision-making-with-trie-tree/"  data-hatena-bookmark-layout="touch" data-hatena-bookmark-width="40" data-hatena-bookmark-height="40" title="このエントリーをはてなブックマークに追加"><i class="fas fa-bookmark"></i></a>
        
        
          <a class="sns-share line-share" href="https://social-plugins.line.me/lineit/share?url=https%3a%2f%2fbrunopacheco1.github.io%2fposts%2foptimizing-decision-making-with-trie-tree%2f"><i class="fab fa-line"></i></a>
        
        
          <a class="sns-share linkedIn-share" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fbrunopacheco1.github.io%2fposts%2foptimizing-decision-making-with-trie-tree%2f"><i class="fab fa-linkedin"></i></a>
        
      </div>
    
    
     © 2023    ·  Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/naro143/hugo-coder-portfolio">CoderPortfolio</a>. 

  </section>
</footer>
<div class="fixed-bar">
  <section class="container">
    
    
      <div class="sns-shares pc-sns-shares">
        
          <a class="sns-share twitter-share" href="https://twitter.com/intent/tweet?original_referer=https%3a%2f%2fbrunopacheco1.github.io%2fposts%2foptimizing-decision-making-with-trie-tree%2f&ref_src=twsrc%5Etfw&text=Optimizing%20Decision%20Making%20with%20a%20Trie%20Tree-Based%20Rules%20Engine%3a%20An%20Experience%20Report Bruno%20Pacheco&tw_p=tweetbutton&url=https%3a%2f%2fbrunopacheco1.github.io%2fposts%2foptimizing-decision-making-with-trie-tree%2f"><i class="fab fa-twitter"></i></a>
        
        
          <a class="fb btn sns-share fb-share" href="http://www.facebook.com/share.php?u=https%3a%2f%2fbrunopacheco1.github.io%2fposts%2foptimizing-decision-making-with-trie-tree%2f" onclick="window.open(this.href, 'FBwindow', 'width=650, height=450, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fab fa-facebook-f"></i></a>
        
        
          <a class="sns-share hatena-share" href="http://b.hatena.ne.jp/entry/https://brunopacheco1.github.io/posts/optimizing-decision-making-with-trie-tree/"  data-hatena-bookmark-layout="touch" data-hatena-bookmark-width="40" data-hatena-bookmark-height="40" title="このエントリーをはてなブックマークに追加"><i class="fas fa-bookmark"></i></a>
        
        
          <a class="sns-share line-share" href="https://social-plugins.line.me/lineit/share?url=https%3a%2f%2fbrunopacheco1.github.io%2fposts%2foptimizing-decision-making-with-trie-tree%2f"><i class="fab fa-line"></i></a>
        
        
          <a class="sns-share linkedIn-share" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fbrunopacheco1.github.io%2fposts%2foptimizing-decision-making-with-trie-tree%2f"><i class="fab fa-linkedin"></i></a>
        
      </div>
    
  </section>
</div>

      
    </main>

    

  <script src="/js/app.js"></script>
  
  </body>
</html>
